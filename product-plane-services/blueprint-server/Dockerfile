FROM openjdk:17-alpine

VOLUME /tmp

COPY ./product-plane-services/blueprint-server/target/odm-platform-pp-blueprint-server-*.jar ./application.jar

ARG SPRING_PROFILES_ACTIVE=docker
ARG SPRING_HOSTNAME=localhost
ARG SPRING_PORT=8003
ARG SPRING_PROPS
ARG JAVA_OPTS
ARG DATABASE_URL=jdbc:postgresql://localhost:5432/odmpdb
ARG DATABASE_USERNAME=usr
ARG DATABASE_PASSWORD=pwd
ARG FLYWAY_SCHEMA=ODMBLUEPRINT
ARG FLYWAY_SCRIPTS_DIR=postgresql
ARG H2_CONSOLE_ENABLED=false
ARG H2_CONSOLE_PATH=h2-console

ARG GIT_PROVIDER=GITHUB
ARG GIT_AUTH_OAUTH2_CLIENT_PROVIDER_TOKEN_URI=null
ARG GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_CLIENT_ID=null
ARG GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_CLIENT_SECRET=null
ARG GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_SCOPE=null
ARG GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_AUTHORIZATION_GRANT_TYPE=null
ARG GIT_AUTH_PAT_USERNAME=null
ARG GIT_AUTH_PAT_TOKEN=null

ENV SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE}
ENV SPRING_HOSTNAME=${SPRING_HOSTNAME}
ENV SPRING_PORT=${SPRING_PORT}
ENV SPRING_PROPS=${SPRING_PROPS}
ENV JAVA_OPTS=${JAVA_OPTS}
ENV DATABASE_URL=${DATABASE_URL}
ENV DATABASE_USERNAME=${DATABASE_USERNAME}
ENV DATABASE_PASSWORD=${DATABASE_PASSWORD}
ENV FLYWAY_SCHEMA=${FLYWAY_SCHEMA}
ENV FLYWAY_SCRIPTS_DIR=${FLYWAY_SCRIPTS_DIR}
ENV H2_CONSOLE_ENABLED=${H2_CONSOLE_ENABLED}
ENV H2_CONSOLE_PATH=${H2_CONSOLE_PATH}
ENV GIT_PROVIDER=${GIT_PROVIDER}
ENV GIT_AUTH_OAUTH2_CLIENT_PROVIDER_TOKEN_URI=${GIT_AUTH_OAUTH2_CLIENT_PROVIDER_TOKEN_URI}
ENV GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_CLIENT_ID=${GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_CLIENT_ID}
ENV GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_CLIENT_SECRET=${GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_CLIENT_SECRET}
ENV GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_SCOPE=${GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_SCOPE}
ENV GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_AUTHORIZATION_GRANT_TYPE=${GIT_AUTH_OAUTH2_CLIENT_REGISTRATION_AUTHORIZATION_GRANT_TYPE}
ENV GIT_AUTH_PAT_USERNAME=${GIT_AUTH_PAT_USERNAME}
ENV GIT_AUTH_PAT_TOKEN=${GIT_AUTH_PAT_TOKEN}

EXPOSE $SPRING_PORT

ENTRYPOINT [ "sh", "-c", "java $JAVA_OPTS  -Dspring.profiles.active=$SPRING_PROFILES_ACTIVE $SPRING_PROPS -jar ./application.jar" ]