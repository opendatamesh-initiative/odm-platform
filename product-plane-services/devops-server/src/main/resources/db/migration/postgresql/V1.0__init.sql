-- Postgres 11;

CREATE SCHEMA IF NOT EXISTS "ODMDEVOPS";
CREATE SEQUENCE IF NOT EXISTS "ODMDEVOPS".HIBERNATE_SEQUENCE START WITH 1;


-- ACTIVITIES ============================================
CREATE TABLE "ODMDEVOPS"."ACTIVITIES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) PRIMARY KEY,
    "DATA_PRODUCT_ID" VARCHAR(255),
    "DATA_PRODUCT_VERSION" VARCHAR(255),
    "STAGE" VARCHAR(255),
    "STATUS" VARCHAR(125),
    "RESULTS" VARCHAR,
    "ERRORS" VARCHAR,

    "CREATED_AT" TIMESTAMP,
    "STARTED_AT" TIMESTAMP,
    "FINISHED_AT" TIMESTAMP
);


-- TASKS ============================================
CREATE TABLE "ODMDEVOPS"."TASKS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ACTIVITY_ID" BIGINT,
    "EXECUTOR_REF" VARCHAR(500),
    "TEMPLATE" VARCHAR,
    "CONFIGURATIONS" VARCHAR,
    "STATUS" VARCHAR(125),
    "RESULTS" VARCHAR,
    "ERRORS" VARCHAR,
    
    "CREATED_AT" TIMESTAMP,
    "STARTED_AT" TIMESTAMP,
    "FINISHED_AT" TIMESTAMP
);


-- LIFECYCLES ============================================
CREATE TABLE "ODMDEVOPS"."LIFECYCLES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) PRIMARY KEY,
    "DATA_PRODUCT_ID" VARCHAR(255),
    "DATA_PRODUCT_VERSION" VARCHAR(255),
    "STAGE" VARCHAR(255),
    "RESULTS" VARCHAR,
    "STARTED_AT" TIMESTAMP,
    "FINISHED_AT" TIMESTAMP
);

-- TASKS FKs
ALTER TABLE "ODMDEVOPS"."TASKS" ADD CONSTRAINT "C_FK1__TASKS" FOREIGN KEY("ACTIVITY_ID") REFERENCES "ODMDEVOPS"."ACTIVITIES"("ID");

