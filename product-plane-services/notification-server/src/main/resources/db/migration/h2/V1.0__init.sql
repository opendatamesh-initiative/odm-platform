-- H2 2.1.214;

CREATE USER IF NOT EXISTS "SA" SALT '582a7e34517160c6' HASH '6b2d59d21c92ab85fb76c10fe4a0873b2745eeeae07aa2001a8c42a5577baf72' ADMIN;
CREATE SCHEMA IF NOT EXISTS "ODMNOTIFICATION";
CREATE SEQUENCE "ODMNOTIFICATION"."HIBERNATE_SEQUENCE" START WITH 1;


-- ENTITIES ============================================================================================================

-- OBSERVERS -----------------------------------------------------------------------------------------------------------
CREATE MEMORY TABLE "ODMNOTIFICATION"."OBSERVERS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "NAME" CHARACTER VARYING(255),
    "DISPLAY_NAME" CHARACTER VARYING(255),
    "OBSERVER_URL" CHARACTER VARYING(1000),
    "CREATED_AT" TIMESTAMP,
    "UPDATED_AT" TIMESTAMP
);
ALTER TABLE "ODMNOTIFICATION"."OBSERVERS" ADD CONSTRAINT "ODMNOTIFICATION"."C_PK_OBSERVERS" PRIMARY KEY("ID");

-- EVENTS --------------------------------------------------------------------------------------------------------------

CREATE MEMORY TABLE "ODMNOTIFICATION"."EVENTS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "TYPE" VARCHAR(255),
    "ENTITY_ID" VARCHAR(255),
    "BEFORE_STATE" TEXT,
    "AFTER_STATE" TEXT,
    "TIME" TIMESTAMP
);
ALTER TABLE "ODMNOTIFICATION"."EVENTS" ADD CONSTRAINT "ODMNOTIFICATION"."C_PK_EVENTS" PRIMARY KEY("ID");

-- NOTIFICATION --------------------------------------------------------------------------------------------------------
CREATE MEMORY TABLE "ODMNOTIFICATION"."NOTIFICATIONS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "OBSERVER_ID" BIGINT,
    "EVENT_ID" BIGINT,
    "STATUS" VARCHAR(255),
    "PROCESSING_OUTPUT" VARCHAR,
    "RECEIVED_AT" TIMESTAMP,
    "PROCESSED_AT" TIMESTAMP
);
ALTER TABLE "ODMNOTIFICATION"."NOTIFICATIONS" ADD CONSTRAINT "ODMNOTIFICATION"."C_PK_NOTIFICATIONS" PRIMARY KEY("ID");


-- FOREING KEYS ========================================================================================================

-- NOTIFICATION FKs
ALTER TABLE "ODMNOTIFICATION"."NOTIFICATIONS" ADD CONSTRAINT "ODMNOTIFICATION"."C_FK1__NOTIFICATIONS" FOREIGN KEY("OBSERVER_ID") REFERENCES "ODMNOTIFICATION"."OBSERVERS"("ID") ON DELETE NO ACTION;
ALTER TABLE "ODMNOTIFICATION"."NOTIFICATIONS" ADD CONSTRAINT "ODMNOTIFICATION"."C_FK2__NOTIFICATIONS" FOREIGN KEY("EVENT_ID") REFERENCES "ODMNOTIFICATION"."EVENTS"("ID") ON DELETE NO ACTION;
